<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Login â€” YOTT</title>
  <style>
    body { background:#061021; color:#fff; display:flex; justify-content:center; align-items:center; height:100vh; font-family:Arial, sans-serif; }
    .box { background:#0b1220; padding:30px; border-radius:8px; width:300px; text-align:center; }
    input { width:100%; padding:8px; margin:8px 0; border-radius:4px; border:none; }
    button { padding:10px 20px; background:#06b6d4; border:none; border-radius:4px; color:#fff; cursor:pointer; }
    .msg { margin-top:10px; color:#f88; }
  </style>
</head>
<body>
  <div class="box">
    <h2>Enter Access Code</h2>
    <input id="code" placeholder="Access Code" />
    <button onclick="login()">Login</button>
    <div class="msg" id="msg"></div>
  </div>

  <script>
    function getDeviceID() {
      return btoa(navigator.userAgent + navigator.platform);
    }

    function getGPS() {
      return new Promise(resolve => {
        navigator.geolocation.getCurrentPosition(
          pos => resolve({lat: pos.coords.latitude, lon: pos.coords.longitude, acc: pos.coords.accuracy}),
          err => resolve(null),
          { enableHighAccuracy: true }
        );
      });
    }

    async function login() {
      const code = document.getElementById("code").value.trim();
      if (!code) {
        document.getElementById("msg").innerText = "Enter a code";
        return;
      }

      const device = getDeviceID();
      const gps = await getGPS();

      const body = {
        code,
        device,
        lat: gps ? gps.lat : "",
        lon: gps ? gps.lon : "",
        acc: gps ? gps.acc : ""
      };

      const res = await fetch("/.netlify/functions/validate-session", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });

      const data = await res.json();
      if (!data.valid) {
        document.getElementById("msg").innerText = "Invalid or expired code";
        return;
      }

      document.cookie = "session=" + data.token + "; path=/";
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
